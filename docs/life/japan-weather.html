<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>埼玉県お天気ボード</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-sky-50 text-slate-800 min-h-screen">
  <header class="bg-white border-b border-sky-100 py-8 mb-8 shadow-sm">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl font-extrabold text-sky-600 tracking-tight">SAITAMA Weather</h1>
      <p id="update-time" class="text-slate-400 mt-2 text-sm italic"></p>
    </div>
  </header>

  <main class="container mx-auto px-4">
    <div id="weather-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

    <div class="mt-12 p-6 bg-sky-100/50 rounded-2xl border-2 border-dashed border-sky-200">
      <h2 class="font-bold text-sky-700 mb-2 font-mono text-sm uppercase tracking-widest">Dev Note</h2>
      <p class="text-sm text-sky-800 leading-relaxed text-opacity-80">
        埼玉県のエリアコード `110000` を使用。`timeSeries[0].areas` 配列から南部・北部・秩父のデータを抽出しています。
      </p>
    </div>
  </main>

  <footer class="container mx-auto px-4 pb-10">
    <div class="mt-8 text-center text-xs text-slate-500">
      このツールは気象庁のAPIと天気アイコン画像を取得するため、インターネット接続が必要です。
    </div>
  </footer>

  <script>
    const API_URL = "https://www.jma.go.jp/bosai/forecast/data/forecast/110000.json";

    async function loadSaitamaWeather() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();

        // 発表時刻
        const reportTime = new Date(data[0].reportDatetime).toLocaleString("ja-JP");
        document.getElementById("update-time").innerText = `最終更新: ${reportTime}`;

        const grid = document.getElementById("weather-grid");
        grid.innerHTML = "";

        // 埼玉県内の全エリア（南部・北部・秩父）をループ
        const areas = data[0].timeSeries[0].areas;

        const fallbackIcon =
          "data:image/svg+xml;utf8," +
          "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>" +
          "<circle cx='32' cy='32' r='14' fill='%23fbbf24'/>" +
          "<g stroke='%23f59e0b' stroke-width='4' stroke-linecap='round'>" +
          "<line x1='32' y1='6' x2='32' y2='16'/>" +
          "<line x1='32' y1='48' x2='32' y2='58'/>" +
          "<line x1='6' y1='32' x2='16' y2='32'/>" +
          "<line x1='48' y1='32' x2='58' y2='32'/>" +
          "<line x1='14' y1='14' x2='21' y2='21'/>" +
          "<line x1='43' y1='43' x2='50' y2='50'/>" +
          "<line x1='14' y1='50' x2='21' y2='43'/>" +
          "<line x1='43' y1='21' x2='50' y2='14'/>" +
          "</g></svg>";

        areas.forEach((area) => {
          const name = area.area.name;
          const weatherRaw = area.weathers[0];
          const weather = weatherRaw ? weatherRaw.replace(/\s+/g, " ").trim() : "";
          const code = area.weatherCodes[0];
          const icon = `https://www.jma.go.jp/bosai/forecast/img/${code}.png`;

          const card = `
            <div class="bg-white rounded-3xl p-8 shadow-xl shadow-sky-900/5 border border-white hover:scale-105 transition-transform duration-300">
              <h3 class="text-xl font-bold text-slate-700 border-b pb-4 mb-6">${name}</h3>
              <div class="flex flex-col items-center">
                <img src="${icon}" alt="${weather}" class="w-24 h-24 object-contain drop-shadow-lg" loading="lazy" onerror="this.onerror=null; this.src='${fallbackIcon}'">
                <p class="mt-6 text-lg font-medium text-center leading-relaxed text-slate-600">
                  ${weather}
                </p>
              </div>
            </div>
          `;
          grid.insertAdjacentHTML("beforeend", card);
        });
      } catch (e) {
        console.error("データの読み込みに失敗:", e);
        document.getElementById("weather-grid").innerHTML = "<p class='col-span-3 text-center text-red-400'>気象データの取得に失敗しました。</p>";
      }
    }

    loadSaitamaWeather();
  </script>
</body>
</html>
