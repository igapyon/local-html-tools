<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>埼玉県お天気ボード</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <div class="max-w-5xl mx-auto bg-white shadow-md rounded-lg p-6 relative">
    <button type="button" class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-1 px-2 rounded" aria-label="メニュー" onclick="toggleMenu()">
      <svg aria-hidden="true" viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/>
      </svg>
    </button>
    <div id="menuPanel" class="absolute top-12 right-4 bg-white border border-gray-200 rounded shadow-md hidden z-20">
      <a href="../index.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">トップへ戻る</a>
    </div>

    <header class="text-center mb-6">
      <h1 class="text-2xl font-bold tracking-tight">Japan Weather</h1>
      <p id="update-time" class="text-gray-500 mt-2 text-sm italic"></p>
    </header>

    <main>
      <div id="weather-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

      <div class="mt-12 p-6 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200">
        <h2 class="font-bold text-gray-700 mb-2 font-mono text-sm uppercase tracking-widest">Dev Note</h2>
        <p class="text-sm text-gray-700 leading-relaxed text-opacity-80">
          埼玉県のエリアコード `110000` を使用。`timeSeries[0].areas` 配列から南部・北部・秩父のデータを抽出しています。
        </p>
      </div>
    </main>

    <footer class="pt-8">
      <div class="text-center text-xs text-gray-500">
        このツールは気象庁のAPIと天気アイコン画像を取得するため、インターネット接続が必要です。
      </div>
    </footer>
  </div>

  <script>
    const API_URL = "https://www.jma.go.jp/bosai/forecast/data/forecast/110000.json";

    async function loadSaitamaWeather() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();

        // 発表時刻
        const reportTime = new Date(data[0].reportDatetime).toLocaleString("ja-JP");
        document.getElementById("update-time").innerText = `最終更新: ${reportTime}`;

        const grid = document.getElementById("weather-grid");
        grid.innerHTML = "";

        // 埼玉県内の全エリア（南部・北部・秩父）をループ
        const areas = data[0].timeSeries[0].areas;

        const fallbackIcon =
          "data:image/svg+xml;utf8," +
          "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>" +
          "<circle cx='32' cy='32' r='14' fill='%23fbbf24'/>" +
          "<g stroke='%23f59e0b' stroke-width='4' stroke-linecap='round'>" +
          "<line x1='32' y1='6' x2='32' y2='16'/>" +
          "<line x1='32' y1='48' x2='32' y2='58'/>" +
          "<line x1='6' y1='32' x2='16' y2='32'/>" +
          "<line x1='48' y1='32' x2='58' y2='32'/>" +
          "<line x1='14' y1='14' x2='21' y2='21'/>" +
          "<line x1='43' y1='43' x2='50' y2='50'/>" +
          "<line x1='14' y1='50' x2='21' y2='43'/>" +
          "<line x1='43' y1='21' x2='50' y2='14'/>" +
          "</g></svg>";

        areas.forEach((area) => {
          const name = area.area.name;
          const weatherRaw = area.weathers[0];
          const weather = weatherRaw ? weatherRaw.replace(/\s+/g, " ").trim() : "";
          const code = area.weatherCodes[0];
          const icon = `https://raw.githubusercontent.com/ciscorn/jma-weather-images/master/output/${code}.png`;

          const card = `
            <div class="bg-white rounded-3xl p-8 shadow-xl shadow-sky-900/5 border border-white hover:scale-105 transition-transform duration-300">
              <h3 class="text-xl font-bold text-slate-700 border-b pb-4 mb-6">${name}</h3>
              <div class="flex flex-col items-center">
                <img src="${icon}" alt="${weather}" class="w-24 h-24 object-contain drop-shadow-lg" loading="lazy" onerror="this.onerror=null; this.src='${fallbackIcon}'">
                <p class="mt-6 text-lg font-medium text-center leading-relaxed text-slate-600">
                  ${weather}
                </p>
              </div>
            </div>
          `;
          grid.insertAdjacentHTML("beforeend", card);
        });
      } catch (e) {
        console.error("データの読み込みに失敗:", e);
        document.getElementById("weather-grid").innerHTML = "<p class='col-span-3 text-center text-red-400'>気象データの取得に失敗しました。</p>";
      }
    }

    loadSaitamaWeather();

    function toggleMenu() {
      const panel = document.getElementById("menuPanel");
      if (panel) panel.classList.toggle("hidden");
    }
  </script>
</body>
</html>
