<!--
Copyright 2025 Toshiki Iga

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>find æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <div class="max-w-3xl mx-auto bg-white shadow-md rounded-lg p-6 relative">
    <button type="button" class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-1 px-2 rounded" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼" onclick="toggleMenu()">
      <svg aria-hidden="true" viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M4 6h16"/>
        <path d="M4 12h16"/>
        <path d="M4 18h16"/>
      </svg>
    </button>
    <div id="menuPanel" class="absolute top-12 right-4 bg-white border border-gray-200 rounded shadow-md hidden">
      <a href="../index.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
    </div>

    <h1 class="text-2xl font-bold mb-6 pr-10"><span aria-hidden="true" class="mr-2">ğŸ”</span>find æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</h1>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="flex items-center gap-2 mb-2 font-semibold">
          <span>æ¤œç´¢é–‹å§‹ãƒ‘ã‚¹</span>
          <span class="text-red-500 font-bold" aria-hidden="true">*</span><span class="sr-only">å¿…é ˆ</span>
        </label>
        <input type="text" id="basePath" placeholder="ä¾‹: . / ~/projects" class="border border-gray-300 rounded w-full p-2" value=".">
      </div>
      <div>
        <label class="block mb-2 font-semibold">å¯¾è±¡ã®ç¨®é¡:</label>
        <select id="targetType" class="border border-gray-300 rounded w-full p-2">
          <option value="any">æŒ‡å®šãªã—ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰</option>
          <option value="file" selected>ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ (-type f)</option>
          <option value="dir">ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿ (-type d)</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block mb-2 font-semibold">æ‹¡å¼µå­:</label>
        <input type="text" id="extension" placeholder="ä¾‹: txt / wav / jpg / java" class="border border-gray-300 rounded w-full p-2">
      </div>
      <div>
        <label class="block mb-2 font-semibold">åå‰ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰å¯ï¼‰:</label>
        <input type="text" id="namePattern" placeholder="ä¾‹: report / *.log / data??.csv" class="border border-gray-300 rounded w-full p-2 mb-2">
        <label class="flex items-center gap-2 text-sm text-gray-600">
          <input type="checkbox" id="caseInsensitive" class="rounded border-gray-300">
          å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ (-iname)
        </label>
      </div>
    </div>

    <details class="mb-4 border border-gray-200 rounded-lg p-3 bg-gray-50">
      <summary class="cursor-pointer font-semibold text-gray-700">è©³ç´°æ¡ä»¶</summary>
      <div class="mt-4">
        <label class="block mb-2 font-semibold">ã‚µã‚¤ã‚ºæ¡ä»¶:</label>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4">
          <select id="sizeComparator" class="border border-gray-300 rounded w-full p-2">
            <option value="min">ä»¥ä¸Š (>=)</option>
            <option value="max">ä»¥ä¸‹ (<=)</option>
          </select>
          <input type="number" id="sizeValue" placeholder="ä¾‹: 10" class="border border-gray-300 rounded w-full p-2">
          <select id="sizeUnit" class="border border-gray-300 rounded w-full p-2">
            <option value="K">KB</option>
            <option value="M" selected>MB</option>
            <option value="G">GB</option>
          </select>
        </div>

        <label class="block mb-2 font-semibold">æ›´æ–°æ—¥æ™‚æ¡ä»¶:</label>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4">
          <select id="mtimeComparator" class="border border-gray-300 rounded w-full p-2">
            <option value="within" selected>ç›´è¿‘Næ—¥ä»¥å†…</option>
            <option value="older">Næ—¥ã‚ˆã‚Šå‰</option>
          </select>
          <input type="number" id="mtimeValue" placeholder="ä¾‹: 7" class="border border-gray-300 rounded w-full p-2">
          <div class="flex items-center text-sm text-gray-600">æ—¥</div>
        </div>

        <label class="block mb-2 font-semibold">æ·±ã•æ¡ä»¶:</label>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <input type="number" id="minDepth" placeholder="æœ€å°æ·±ã• (mindepth)" class="border border-gray-300 rounded w-full p-2">
          <input type="number" id="maxDepth" placeholder="æœ€å¤§æ·±ã• (maxdepth)" class="border border-gray-300 rounded w-full p-2">
        </div>
      </div>
    </details>

    <label class="block mb-2 font-semibold">å†…å®¹æ¤œç´¢:</label>
    <input type="text" id="contentPattern" placeholder="ä¾‹: ERROR / TODO / 404" class="border border-gray-300 rounded w-full p-2 mb-2">
    <label class="flex items-center gap-2 mb-4 text-sm text-gray-600">
      <input type="checkbox" id="useRipgrep" class="rounded border-gray-300" checked>
      rg ã§æ¤œç´¢ï¼ˆæœªãƒã‚§ãƒƒã‚¯ãªã‚‰ grep -E ã‚’ä½¿ç”¨ï¼‰
    </label>

    <button onclick="generateFindCommand()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded mb-4">
      find ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ
    </button>

    <div class="relative">
      <code id="findCmd" class="bg-gray-100 p-3 block rounded overflow-x-auto whitespace-pre pr-10"></code>
      <button class="absolute top-2 right-2 bg-gray-200 px-2 py-1 rounded text-sm hover:bg-gray-300" onclick="copyToClipboard('findCmd')">ğŸ“‹</button>
    </div>

    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-4 py-2 rounded shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none">
      ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ
    </div>
  </div>

  <script>
    function quoteIfNeeded(value) {
      if (!value) return value;
      if (/[\s"]/g.test(value)) {
        const escaped = value.replace(/"/g, '\\"');
        return `"${escaped}"`;
      }
      return value;
    }

    function quoteAlways(value) {
      if (!value) return value;
      const escaped = value.replace(/"/g, '\\"');
      return `"${escaped}"`;
    }

    function normalizePattern(pattern) {
      if (!pattern) return "";
      if (/[*?\[]/.test(pattern)) return pattern;
      return `*${pattern}*`;
    }

    function generateFindCommand() {
      const basePath = document.getElementById("basePath").value.trim() || ".";
      const targetType = document.getElementById("targetType").value;
      const namePattern = document.getElementById("namePattern").value.trim();
      const extension = document.getElementById("extension").value.trim();
      const caseInsensitive = document.getElementById("caseInsensitive").checked;
      const sizeComparator = document.getElementById("sizeComparator").value;
      const sizeValue = document.getElementById("sizeValue").value.trim();
      const sizeUnit = document.getElementById("sizeUnit").value;
      const mtimeComparator = document.getElementById("mtimeComparator").value;
      const mtimeValue = document.getElementById("mtimeValue").value.trim();
      const minDepth = document.getElementById("minDepth").value.trim();
      const maxDepth = document.getElementById("maxDepth").value.trim();
      const contentPattern = document.getElementById("contentPattern").value.trim();
      const useRipgrep = document.getElementById("useRipgrep").checked;

      const parts = [];
      const nameFlag = caseInsensitive ? "-iname" : "-name";

      if (maxDepth) {
        const num = Number(maxDepth);
        if (!Number.isInteger(num) || num < 0) {
          alert("æœ€å¤§æ·±ã•ã¯0ä»¥ä¸Šã®æ•´æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        parts.push(`-maxdepth ${num}`);
      }
      if (minDepth) {
        const num = Number(minDepth);
        if (!Number.isInteger(num) || num < 0) {
          alert("æœ€å°æ·±ã•ã¯0ä»¥ä¸Šã®æ•´æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        parts.push(`-mindepth ${num}`);
      }
      if (minDepth && maxDepth && Number(minDepth) > Number(maxDepth)) {
        alert("æœ€å°æ·±ã•ãŒæœ€å¤§æ·±ã•ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚");
        return;
      }

      if (targetType === "file") parts.push("-type f");
      if (targetType === "dir") parts.push("-type d");

      if (namePattern) {
        const pattern = normalizePattern(namePattern);
        parts.push(`${nameFlag} "${pattern}"`);
      }

      if (extension) {
        const cleaned = extension.replace(/^\./, "").trim();
        if (cleaned) {
          parts.push(`${nameFlag} "*.${cleaned}"`);
        }
      }

      if (sizeValue) {
        const num = Number(sizeValue);
        if (!Number.isFinite(num) || num <= 0) {
          alert("ã‚µã‚¤ã‚ºã¯æ­£ã®æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        const sign = sizeComparator === "min" ? "+" : "-";
        parts.push(`-size ${sign}${num}${sizeUnit}`);
      }

      if (mtimeValue) {
        const num = Number(mtimeValue);
        if (!Number.isFinite(num) || num < 0) {
          alert("æ›´æ–°æ—¥æ•°ã¯0ä»¥ä¸Šã®æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        const sign = mtimeComparator === "within" ? "-" : "+";
        parts.push(`-mtime ${sign}${Math.floor(num)}`);
      }

      let cmd = `find ${quoteIfNeeded(basePath)}${parts.length ? " " + parts.join(" ") : ""}`;
      if (contentPattern) {
        const tool = useRipgrep ? "rg" : "grep -nE";
        const quoted = quoteAlways(contentPattern);
        cmd += ` -print0 | xargs -0 ${tool} ${quoted}`;
      }
      document.getElementById("findCmd").textContent = cmd;
    }

    function copyToClipboard(id) {
      const text = document.getElementById(id).textContent;
      if (!text) return;
      const temp = document.createElement("textarea");
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
      showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.remove("opacity-0", "pointer-events-none");
      toast.classList.add("opacity-100");
      setTimeout(() => {
        toast.classList.remove("opacity-100");
        toast.classList.add("opacity-0", "pointer-events-none");
      }, 2000);
    }

    function toggleMenu() {
      const panel = document.getElementById("menuPanel");
      if (!panel) return;
      panel.classList.toggle("hidden");
    }
  </script>
</body>
</html>
