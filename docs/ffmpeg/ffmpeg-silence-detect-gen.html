<!--
Copyright 2025 Toshiki Iga

Licensed under the Apache License, Version 2.0
-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>FFmpeg ç„¡éŸ³åŒºé–“æ¤œå‡ºã‚³ãƒãƒ³ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <div class="max-w-2xl mx-auto bg-white shadow-md rounded-lg p-6 relative">
    <button type="button" class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-1 px-2 rounded" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼" onclick="toggleMenu()">
      <svg aria-hidden="true" viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M4 6h16"/>
        <path d="M4 12h16"/>
        <path d="M4 18h16"/>
      </svg>
    </button>
    <div id="menuPanel" class="absolute top-12 right-4 bg-white border border-gray-200 rounded shadow-md hidden">
      <a href="../index.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
    </div>

    <h1 class="text-2xl font-bold mb-6"><span aria-hidden="true" class="mr-2">ğŸ”‡</span>FFmpeg ç„¡éŸ³åŒºé–“æ¤œå‡ºã‚³ãƒãƒ³ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</h1>

    <label class="flex flex-wrap items-center gap-2 mb-2 font-semibold">
      <span>éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«å</span>
      <span class="text-red-500 font-bold" aria-hidden="true">*</span><span class="sr-only">å¿…é ˆ</span>
      <span class="relative inline-flex items-center group">
        <span class="inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-gray-600 bg-gray-200 rounded-full">?</span>
        <span class="absolute left-1/2 top-full mt-2 w-72 -translate-x-1/2 rounded bg-gray-900 text-white text-xs px-3 py-2 opacity-0 group-hover:opacity-100 transition pointer-events-none">
          ä¾‹: input.wav / input.flac / input.mp3
        </span>
      </span>
      <span>ï¼š</span>
    </label>
    <input type="text" id="audioFile" placeholder="ä¾‹: input.wav" class="border border-gray-300 rounded w-full p-2 mb-4">

    <label class="block mb-2 font-semibold">ç„¡éŸ³åˆ¤å®šã—ãã„å€¤ (dB):</label>
    <input type="number" id="noiseDb" step="1" value="-50" class="border border-gray-300 rounded w-full p-2 mb-4">

    <label class="block mb-2 font-semibold">ç„¡éŸ³ã¨ã¿ãªã™æœ€å°æ™‚é–“ (ç§’):</label>
    <input type="number" id="minDuration" step="0.1" value="0.5" class="border border-gray-300 rounded w-full p-2 mb-4">
    <p class="text-sm text-gray-600 mb-4">ä¾‹: 0.5 ã¯ã€Œ0.5ç§’ä»¥ä¸Šç¶šã„ãŸã‚‰ç„¡éŸ³ã€ã¨ã¿ãªã—ã¾ã™ã€‚</p>

    <button onclick="generateSilenceCmd()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded mb-4">
      ffmpeg ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ
    </button>

    <div class="relative">
      <code id="silenceCmd" class="bg-gray-100 p-3 block rounded overflow-x-auto whitespace-pre pr-10"></code>
      <button class="absolute top-2 right-2 bg-gray-200 px-2 py-1 rounded text-sm hover:bg-gray-300" onclick="copyToClipboard('silenceCmd')">ğŸ“‹</button>
    </div>

    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-4 py-2 rounded shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none">
      ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ
    </div>
  </div>

  <script>
    function generateSilenceCmd() {
      const audioFile = document.getElementById("audioFile").value.trim();
      const noiseDb = document.getElementById("noiseDb").value.trim();
      const minDuration = document.getElementById("minDuration").value.trim();

      if (!audioFile) {
        alert("éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      if (noiseDb === "" || isNaN(Number(noiseDb))) {
        alert("ã—ãã„å€¤(dB)ã¯æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      if (minDuration === "" || isNaN(Number(minDuration))) {
        alert("æœ€å°æ™‚é–“(ç§’)ã¯æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const base = audioFile.replace(/\.[^/.]+$/i, "");
      const logFile = `${base}-silence.log`;
      const cmd = `ffmpeg -i ${audioFile} -af silencedetect=noise=${noiseDb}dB:d=${minDuration} -f null - 2>&1 | tee ${logFile}`;
      document.getElementById("silenceCmd").textContent = cmd;
    }

    function copyToClipboard(id) {
      const text = document.getElementById(id).textContent;
      const temp = document.createElement("textarea");
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
      showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.remove("opacity-0", "pointer-events-none");
      toast.classList.add("opacity-100");
      setTimeout(() => {
        toast.classList.remove("opacity-100");
        toast.classList.add("opacity-0", "pointer-events-none");
      }, 2000);
    }

    function toggleMenu() {
      const panel = document.getElementById("menuPanel");
      if (!panel) return;
      panel.classList.toggle("hidden");
    }
  </script>
</body>
</html>
